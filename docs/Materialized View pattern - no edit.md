زمانی که داده‌ها برای عملیات جستجوی مورد نیاز قالب‌بندی نشده باشند، نماهای از پیش پرجمع‌شده روی داده‌ها را در یک یا چند انبار داده ایجاد کنید. این می تواند به پشتیبانی کارآمد پرس و جو و استخراج داده ها و بهبود عملکرد برنامه کمک کند.

## Context and problem

هنگام ذخیره داده ها، اولویت برای توسعه دهندگان و مدیران داده ها اغلب بر نحوه ذخیره داده ها متمرکز است، نه نحوه خواندن آنها. فرمت ذخیره سازی انتخاب شده معمولاً با فرمت داده ها، الزامات مدیریت اندازه داده ها و یکپارچگی داده ها و نوع ذخیره در حال استفاده ارتباط نزدیکی دارد. به عنوان مثال، هنگام استفاده از ذخیره‌سازی اسناد NoSQL، داده‌ها اغلب به صورت مجموعه‌ای از مجموعه‌ها نشان داده می‌شوند که هر کدام شامل تمام اطلاعات آن موجودیت است.  
  
با این حال، این می تواند تأثیر منفی بر پرس و جو داشته باشد. هنگامی که یک پرس و جو فقط به زیرمجموعه ای از داده ها از برخی نهادها نیاز دارد، مانند خلاصه ای از سفارشات برای چندین مشتری بدون تمام جزئیات سفارش، باید تمام داده ها را برای نهادهای مربوطه استخراج کند تا اطلاعات مورد نیاز را به دست آورد.

## Solution

برای پشتیبانی از پرس و جوی کارآمد، یک راه حل متداول این است که، پیشاپیش، دیدگاهی تولید شود که داده ها را در قالبی مناسب با مجموعه نتایج مورد نیاز، تحقق بخشد. الگوی Materialized View تولید نماهای از پیش جمع‌شده داده‌ها را در محیط‌هایی توصیف می‌کند که داده‌های مبدأ در قالب مناسب برای پرس‌وجو نیستند، جایی که ایجاد یک پرس و جو مناسب دشوار است، یا جایی که عملکرد پرس و جو به دلیل ماهیت داده یا داده‌ها ضعیف است. فروشگاه.  
  
این نماهای تحقق یافته، که فقط حاوی داده های مورد نیاز یک پرس و جو هستند، به برنامه های کاربردی اجازه می دهد تا به سرعت اطلاعات مورد نیاز خود را به دست آورند. علاوه بر پیوستن به جداول یا ترکیب موجودیت‌های داده، نماهای تحقق‌یافته می‌توانند شامل مقادیر جاری ستون‌ها یا اقلام داده‌ای محاسبه‌شده، نتایج ترکیب مقادیر یا اجرای تبدیل‌ها بر روی اقلام داده و مقادیر مشخص‌شده به عنوان بخشی از پرس‌وجو باشند. یک نمای مادی شده حتی می تواند تنها برای یک پرس و جو بهینه شود.  
  
یک نکته کلیدی این است که یک نمای واقعی و داده‌های موجود در آن کاملاً یکبار مصرف است زیرا می‌توان آن را به طور کامل از ذخیره‌های داده منبع بازسازی کرد. نمای مادی‌شده هرگز مستقیماً توسط یک برنامه به‌روزرسانی نمی‌شود، و بنابراین یک کش تخصصی است.  
  
هنگامی که داده های منبع برای نما تغییر می کند، نما باید برای گنجاندن اطلاعات جدید به روز شود. می‌توانید این کار را به‌طور خودکار یا زمانی که سیستم تغییری در داده‌های اصلی تشخیص دهد، برنامه‌ریزی کنید. در برخی موارد ممکن است لازم باشد که نمای را به صورت دستی بازسازی کنید. شکل نمونه ای از نحوه استفاده از الگوی نمای ماتریال شده را نشان می دهد.

![[Pasted image 20231205111417.png]]

## Issues and considerations

هنگام تصمیم گیری در مورد نحوه اجرای این الگو به نکات زیر توجه کنید:  
  
چگونه و چه زمانی نما به روز می شود. در حالت ایده‌آل، در پاسخ به رویدادی که نشان‌دهنده تغییر در داده‌های منبع است، دوباره تولید می‌شود، اگرچه اگر داده‌های منبع به سرعت تغییر کنند، می‌تواند منجر به سربار بیش از حد شود. روش دیگر، استفاده از یک کار زمان‌بندی‌شده، یک ماشه خارجی یا یک اقدام دستی برای بازسازی نمای را در نظر بگیرید.  
  
در برخی از سیستم‌ها، مانند زمانی که از الگوی منبع‌یابی رویداد استفاده می‌شود تا ذخیره‌ای از رویدادهایی که داده‌ها را تغییر داده‌اند، حفظ کند، نمایش‌های واقعی ضروری هستند. از پیش جمع کردن نماها با بررسی همه رویدادها برای تعیین وضعیت فعلی ممکن است تنها راه برای به دست آوردن اطلاعات از فروشگاه رویداد باشد. اگر از Event Sourcing استفاده نمی کنید، باید در نظر بگیرید که آیا یک نمای مادی مفید است یا خیر. نماهای مادی شده به طور خاص برای یک یا تعداد کمی از پرس و جوها تنظیم می شوند. اگر پرس و جوهای زیادی استفاده شود، نماهای تحقق یافته می تواند منجر به نیازهای ظرفیت ذخیره سازی غیرقابل قبول و هزینه ذخیره سازی شود.  
  
هنگام ایجاد نما، و در صورت بروز این اتفاق در یک برنامه زمانی، هنگام به‌روزرسانی نما، تأثیر آن را بر روی ثبات داده‌ها در نظر بگیرید. اگر داده‌های منبع در نقطه‌ای که نما تولید می‌شود در حال تغییر باشد، کپی داده‌ها در نما کاملاً با داده‌های اصلی سازگار نخواهد بود.  
  
محل ذخیره نما را در نظر بگیرید. لازم نیست نما در همان فروشگاه یا پارتیشن داده اصلی قرار گیرد. می تواند زیرمجموعه ای از چند پارتیشن مختلف باشد.  
  
در صورت گم شدن می توان یک نما را بازسازی کرد. به همین دلیل، اگر نمای گذرا باشد و فقط برای بهبود عملکرد پرس‌وجو با انعکاس وضعیت فعلی داده‌ها یا بهبود مقیاس‌پذیری استفاده شود، می‌توان آن را در حافظه پنهان یا در مکانی کمتر قابل اطمینان ذخیره کرد.  
  
هنگام تعریف نمای تحقق‌یافته، با افزودن اقلام یا ستون‌های داده به آن بر اساس محاسبات یا تبدیل اقلام داده موجود، مقادیر ارسال شده در پرس و جو یا ترکیبی از این مقادیر در صورت لزوم، ارزش آن را به حداکثر برسانید.  
  
در جایی که مکانیسم ذخیره سازی آن را پشتیبانی می کند، نمایه سازی شده را برای افزایش بیشتر عملکرد در نظر بگیرید. اکثر پایگاه های داده رابطه ای از نمایه سازی برای view ها پشتیبانی می کنند، مانند راه حل های کلان داده مبتنی بر Apache Hadoop.

## When to use this pattern

این الگو زمانی مفید است که:  
  
* ایجاد نماهای تحقق یافته بر روی داده هایی که پرس و جوی مستقیم آنها دشوار است، یا در جایی که پرس و جوها باید بسیار پیچیده باشند تا داده هایی را که به صورت عادی، نیمه ساختاریافته یا بدون ساختار ذخیره می شوند استخراج کنند.  
* ایجاد نماهای موقتی که می تواند عملکرد پرس و جو را به طور چشمگیری بهبود بخشد، یا می تواند مستقیماً به عنوان نماهای منبع یا اشیاء انتقال داده برای رابط کاربری، گزارش یا نمایش عمل کند.  
* پشتیبانی از سناریوهای گهگاهی متصل یا قطع شده که در آن اتصال به فروشگاه داده همیشه در دسترس نیست. در این مورد می توان نما را به صورت محلی ذخیره کرد.  
* ساده‌سازی پرس‌و‌جوها و نمایش داده‌ها برای آزمایش به شیوه‌ای که نیازی به دانش فرمت داده‌های منبع ندارد. برای مثال، با پیوستن جداول مختلف در یک یا چند پایگاه داده، یا یک یا چند دامنه در فروشگاه‌های NoSQL، و سپس قالب‌بندی داده‌ها برای استفاده نهایی آن.  
* ارائه دسترسی به زیرمجموعه‌های خاصی از داده‌های منبع که به دلایل امنیتی یا حفظ حریم خصوصی، عموماً نباید در دسترس باشند، قابل تغییر باشند یا به طور کامل در معرض دید کاربران قرار نگیرند.  
* پل زدن بین فروشگاه های داده مختلف، برای استفاده از قابلیت های فردی آنها. به عنوان مثال، استفاده از یک فروشگاه ابری که برای نوشتن به عنوان ذخیره داده مرجع کارآمد است، و یک پایگاه داده رابطه‌ای که عملکرد پرس و جو و خواندن خوبی را برای نگهداری نماهای تحقق‌یافته ارائه می‌دهد.  
* هنگام استفاده از میکروسرویس‌ها، به شما توصیه می‌شود که آن‌ها را از جمله ذخیره‌سازی داده‌ها، به‌صورت آزاد به هم متصل کنید. بنابراین، نماهای مادی می‌توانند به شما در ادغام داده‌های خدماتتان کمک کنند. اگر نماهای تحقق‌یافته در معماری میکروسرویس‌ها یا سناریوی خاص شما مناسب نیستند، لطفاً مرزهای کاملاً تعریف شده‌ای داشته باشید که با طراحی مبتنی بر دامنه (DDD) تراز باشد و داده‌های آنها را در صورت درخواست جمع‌آوری کنید.  

این الگو در شرایط زیر مفید نیست:  
  
* داده های منبع ساده و آسان برای پرس و جو هستند.  
* داده‌های منبع خیلی سریع تغییر می‌کنند یا می‌توان بدون استفاده از نما به آنها دسترسی داشت. در این موارد، باید از سربار پردازش ایجاد نماها اجتناب کنید.  
* سازگاری اولویت بالایی دارد. نماها ممکن است همیشه با داده های اصلی مطابقت کامل نداشته باشند.

## Example

شکل زیر نمونه ای از استفاده از الگوی Materialized View برای تولید خلاصه ای از فروش را نشان می دهد. داده‌های موجود در جداول Order، OrderItem و Customer در پارتیشن‌های جداگانه در یک حساب ذخیره‌سازی Azure ترکیب می‌شوند تا یک نمای حاوی کل ارزش فروش برای هر محصول در دسته Electronics، همراه با شمارش تعداد مشتریانی که خرید کرده‌اند، ایجاد کنند. هر مورد.

![[Pasted image 20231205111604.png]]

ایجاد این نمای مادی شده نیاز به پرس و جوهای پیچیده دارد. با این حال، با نمایش نتیجه پرس و جو به عنوان یک نمای مادی شده، کاربران می توانند به راحتی نتایج را به دست آورند و مستقیماً از آنها استفاده کنند یا آنها را در پرس و جو دیگری بگنجانند. این نما احتمالاً در یک سیستم گزارش دهی یا داشبورد استفاده می شود و می تواند به صورت برنامه ریزی شده مانند هفتگی به روز شود.

> اگرچه این مثال از ذخیره‌سازی جدول Azure استفاده می‌کند، بسیاری از سیستم‌های مدیریت پایگاه داده رابطه‌ای نیز پشتیبانی بومی را برای نماهای مادی‌شده ارائه می‌کنند.


## Next steps

* پرایمر سازگاری داده اطلاعات خلاصه در یک نمای مادی شده باید به گونه ای نگهداری شود که مقادیر داده های اساسی را منعکس کند. با تغییر مقادیر داده ها، ممکن است به روز رسانی خلاصه داده ها در زمان واقعی عملی نباشد، و در عوض باید یک رویکرد در نهایت سازگار را اتخاذ کنید. مسائل مربوط به حفظ ثبات در داده های توزیع شده را خلاصه می کند و مزایا و معاوضه های مدل های سازگاری مختلف را شرح می دهد.

## Related resources

الگوهای زیر نیز ممکن است هنگام اجرای این الگو مرتبط باشند:  
  
* الگوی تفکیک مسئولیت فرمان و پرس و جو (CQRS). برای به روز رسانی اطلاعات در نمای مادی شده با پاسخ دادن به رویدادهایی که هنگام تغییر مقادیر داده های اساسی رخ می دهند، استفاده کنید.  

* الگوی منبع یابی رویداد در ارتباط با الگوی CQRS برای حفظ اطلاعات در یک نمای مادی استفاده کنید. هنگامی که مقادیر داده‌ای که یک نمای واقعی بر اساس آن است، تغییر می‌کند، سیستم می‌تواند رویدادهایی را که این تغییرات را توصیف می‌کنند، افزایش دهد و آنها را در یک فروشگاه رویداد ذخیره کند.

* الگوی جدول شاخص. داده‌ها در نمای مادی‌شده معمولاً توسط یک کلید اصلی سازمان‌دهی می‌شوند، اما پرس‌و‌جوها ممکن است نیاز به بازیابی اطلاعات از این نمای با بررسی داده‌ها در زمینه‌های دیگر داشته باشند. برای ایجاد نمایه‌های ثانویه روی مجموعه‌های داده برای ذخیره‌سازی داده‌هایی که از فهرست‌های ثانویه بومی پشتیبانی نمی‌کنند استفاده کنید.