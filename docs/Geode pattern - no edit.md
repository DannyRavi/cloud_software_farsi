
الگوی ژئود شامل استقرار مجموعه‌ای از خدمات پشتیبان در مجموعه‌ای از گره‌های جغرافیایی است که هر کدام می‌توانند هر درخواستی را برای هر مشتری در هر منطقه ارائه دهند. این الگو اجازه می دهد تا درخواست ها را به سبک فعال-فعال ارائه کند، با توزیع پردازش درخواست در سراسر جهان، تأخیر را بهبود بخشد و دسترسی را افزایش دهد.

![[Pasted image 20231203231759.png]]
## Context and problem

بسیاری از خدمات در مقیاس بزرگ، چالش‌های خاصی در مورد دسترسی و مقیاس جغرافیایی دارند. طرح‌های کلاسیک اغلب داده‌ها را با ذخیره داده‌ها در یک سرور SQL راه دور که به عنوان ردیف محاسباتی برای آن داده‌ها عمل می‌کند، با تکیه بر افزایش مقیاس برای رشد، به محاسبات می‌آورند.  
  
رویکرد کلاسیک ممکن است تعدادی چالش را به همراه داشته باشد:  
  
* مشکلات تأخیر شبکه برای کاربرانی که از آن سوی جهان می آیند تا به نقطه پایانی میزبانی متصل شوند  
* مدیریت ترافیک برای انفجارهای تقاضا که می تواند خدمات را در یک منطقه تحت الشعاع قرار دهد  
* پیچیدگی پرهزینه استقرار نسخه‌های زیرساخت برنامه در چندین منطقه برای یک سرویس 24x7  

زیرساخت ابری مدرن تکامل یافته است تا تعادل بار جغرافیایی سرویس‌های فرانت‌اند را فعال کند، در حالی که امکان تکرار جغرافیایی خدمات باطنی را فراهم می‌کند. برای در دسترس بودن و عملکرد، نزدیکتر کردن اطلاعات به کاربر خوب است. هنگامی که داده ها در یک پایگاه کاربری دوردست توزیع می شوند، انبارهای داده توزیع شده جغرافیایی نیز باید با منابع محاسباتی که داده ها را پردازش می کنند، قرار گیرند. الگوی ژئود محاسبات را به داده ها می آورد.

## Solution

این سرویس را در تعدادی از استقرارهای ماهواره‌ای که در سرتاسر جهان پخش شده‌اند، مستقر کنید، که هر کدام ژئود نامیده می‌شوند. الگوی ژئود از ویژگی‌های کلیدی Azure برای هدایت ترافیک از طریق کوتاه‌ترین مسیر به ژئود نزدیک استفاده می‌کند که تأخیر و عملکرد را بهبود می‌بخشد. هر ژئود پشت یک متعادل کننده بار جهانی قرار دارد و از یک سرویس خواندن-نوشتن تکرار شده جغرافیایی مانند Azure Cosmos DB برای میزبانی صفحه داده استفاده می کند و از سازگاری داده های متقابل ژئود اطمینان حاصل می کند. سرویس‌های تکثیر داده تضمین می‌کنند که ذخیره‌های داده در سراسر ژئودها یکسان هستند، بنابراین همه درخواست‌ها می‌توانند از همه ژئودها ارائه شوند.  
  
تفاوت اصلی بین مهر استقرار و ژئود در این است که ژئودها هرگز به صورت مجزا وجود ندارند. همیشه باید بیش از یک ژئود در یک پلت فرم تولید وجود داشته باشد.

![[Pasted image 20231203231950.png]]


ژئودها دارای مشخصات زیر هستند:

* شامل مجموعه ای از انواع منابع متفاوت است که اغلب در قالب تعریف می شوند.  
* هیچ وابستگی خارج از ردپای ژئود ندارند و مستقل هستند. هیچ ژئودی برای کار کردن به دیگری وابسته نیست و اگر یکی بمیرد، بقیه به کار خود ادامه می دهند.  
* از طریق یک شبکه لبه و صفحه پشتی تکثیر به صورت آزاد کوپل می شوند. به عنوان مثال، می‌توانید از Azure Traffic Manager یا Azure Front Door برای جلوبندی ژئودها استفاده کنید، در حالی که Azure Cosmos DB می‌تواند به عنوان backplane تکرار عمل کند. ژئودها با خوشه ها یکسان نیستند، زیرا آنها یک backplane مشابه را به اشتراک می گذارند، بنابراین پلت فرم از مسائل حد نصاب مراقبت می کند.

الگوی ژئود در معماری‌های کلان داده‌ها رخ می‌دهد که از سخت‌افزار کالا برای پردازش داده‌های موجود در یک ماشین و MapReduce برای ادغام نتایج در بین ماشین‌ها استفاده می‌کنند. کاربرد دیگر محاسبات نزدیک به لبه است که برای کاهش زمان پاسخ، محاسبات را به لبه هوشمند شبکه نزدیک می کند.  
  
سرویس ها می توانند از این الگو در ده ها یا صدها ژئود استفاده کنند. علاوه بر این، انعطاف‌پذیری کل راه‌حل با هر ژئود اضافه‌شده افزایش می‌یابد، زیرا اگر یک یا چند ژئود آفلاین شود، هر ژئود می‌تواند کار را به دست بگیرد.  
  
همچنین می‌توان تکنیک‌های در دسترس بودن محلی، مانند مناطق در دسترس یا مناطق جفت شده را با الگوی ژئود برای در دسترس بودن جهانی افزایش داد. این پیچیدگی را افزایش می‌دهد، اما در صورتی مفید است که معماری شما توسط یک موتور ذخیره‌سازی مانند ذخیره‌سازی blob که فقط می‌تواند به یک منطقه جفت شده تکثیر شود، پشتیبانی شود. شما می توانید ژئودها را در یک ردپای درون منطقه ای، منطقه ای یا منطقه ای با توجه به محدودیت های نظارتی یا تاخیر در مکان مستقر کنید.

## Issues and considerations

برای اجرای این الگو از تکنیک ها و فناوری های زیر استفاده کنید:  
  
* روش‌ها و ابزارهای DevOps مدرن برای تولید و استقرار سریع ژئودهای یکسان در تعداد زیادی از مناطق یا نمونه‌ها.  
* مقیاس خودکار برای مقیاس‌بندی نمونه‌های توان پردازشی محاسباتی و پایگاه داده در یک ژئود. هر ژئود به‌طور جداگانه در محدوده محدودیت‌های صفحه پشتی مشترک مقیاس می‌شود.  
* یک سرویس جلویی مانند Azure Front Door که شتاب محتوای پویا، تقسیم TCP و مسیریابی Anycast را انجام می‌دهد.  
* یک ذخیره‌سازی داده در حال تکرار مانند Azure Cosmos DB برای کنترل سازگاری داده‌ها.  
* فناوری‌های بدون سرور در صورت امکان، برای کاهش هزینه‌های استقرار همیشه روشن، به‌ویژه زمانی که بار در سرتاسر جهان مرتباً متعادل می‌شود. این استراتژی به بسیاری از ژئودها اجازه می دهد تا با حداقل سرمایه گذاری اضافی مستقر شوند. فناوری‌های صورت‌حساب بدون سرور و مبتنی بر مصرف، ضایعات و هزینه‌های ناشی از استقرارهای تکراری توزیع‌شده جغرافیایی را کاهش می‌دهند.  
* مدیریت API برای پیاده‌سازی الگوی طراحی لازم نیست، اما می‌توان آن را به هر ژئودی که در مقابل برنامه عملکرد Azure منطقه قرار می‌گیرد اضافه کرد تا یک لایه API قوی‌تر ارائه کند، به‌عنوان مثال، اجرای عملکردهای اضافی مانند محدود کردن نرخ را ممکن می‌سازد.  
* هنگام تصمیم گیری در مورد نحوه اجرای این الگو به نکات زیر توجه کنید:

هنگام تصمیم گیری در مورد نحوه اجرای این الگو به نکات زیر توجه کنید:  
  
* انتخاب کنید که داده‌ها به صورت محلی در هر منطقه پردازش شوند یا انبوه‌ها در یک ژئود توزیع شوند و نتیجه در سراسر جهان تکرار شود. پردازشگر تغذیه تغییر DB Azure Cosmos این کنترل دانه‌ای را با استفاده از مفهوم ظرف اجاره‌ای و پیشوند leasecollection در اتصال توابع Azure مربوطه ارائه می‌کند. هر رویکرد دارای مزایا و معایب متمایز است.  
* ژئودها می‌توانند پشت سر هم کار کنند، با استفاده از خوراک تغییر Azure Cosmos DB و یک پلت فرم ارتباطی بلادرنگ مانند SignalR. ژئودها می توانند از طریق ژئودهای دیگر در یک الگوی مش با کاربران راه دور ارتباط برقرار کنند، بدون اینکه بدانند کاربر راه دور کجا قرار دارد یا اهمیتی بدهد.  
* این الگوی طراحی به طور ضمنی همه چیز را از هم جدا می کند و در نتیجه یک معماری بسیار پراکنده و جدا شده ایجاد می کند. نحوه ردیابی اجزای مختلف یک درخواست را در نظر بگیرید زیرا ممکن است به صورت ناهمزمان در نمونه های مختلف اجرا شوند. یک استراتژی نظارتی مناسب بسیار مهم است. هر دو Azure Front Door و Azure Cosmos DB را می توان به راحتی با Log Analytics ادغام کرد و Azure Functions باید در کنار Application Insights مستقر شوند تا یک سیستم نظارتی قوی در هر جزء در معماری ارائه دهند.  
* استقرارهای توزیع شده دارای تعداد بیشتری از رازها و نقاط ورودی هستند که به اقدامات امنیتی دارایی نیاز دارند. Key Vault یک لایه امن برای مدیریت مخفی ارائه می کند و هر لایه در معماری API باید به درستی ایمن شود تا تنها نقطه ورودی برای API سرویس جلویی مانند Azure Front Door باشد. Azure Cosmos DB باید ترافیک را به Azure Function Apps و برنامه های Function را به Azure Front Door با استفاده از Microsoft Entra ID یا اقداماتی مانند محدودیت IP محدود کند.  
* عملکرد به شدت تحت تأثیر تعداد ژئودهایی است که مستقر می شوند و برنامه های خدمات برنامه خاص اعمال شده در فناوری API در هر ژئود. استقرار ژئودهای اضافی یا حرکت به سمت سطوح برتر با افزایش هزینه برای حافظه اضافی و محاسبات همراه است، اما این کار را بر اساس هر تراکنش انجام ندهید. آزمایش بار معماری API را پس از استقرار و کنتراست افزایش تعداد ژئودها با افزایش سطح قیمت در نظر بگیرید تا مقرون به صرفه ترین مدل برای نیازهای شما استفاده شود.  
* الزامات در دسترس بودن داده های خود را تعیین کنید. Azure Cosmos DB دارای پرچم های اختیاری برای فعال کردن نوشتن چند منطقه ای، مناطق در دسترس بودن و موارد دیگر است. این موارد در دسترس بودن را برای نمونه Azure Cosmos DB افزایش می‌دهد و یک لایه داده انعطاف‌پذیرتر ایجاد می‌کند، اما با هزینه‌های اضافی همراه است.  
* Azure انواع متعادل کننده های بار را ارائه می دهد که عملکردهای مختلفی را برای توزیع ترافیک ارائه می دهد. از درخت تصمیم برای کمک به انتخاب گزینه مناسب برای قسمت جلویی API خود استفاده کنید.
## When to use this pattern

از این الگو استفاده کنید:  
  
* برای پیاده سازی یک پلتفرم در مقیاس بالا که کاربران در یک منطقه گسترده توزیع شده اند.  
* برای هر سرویسی که به ویژگی های در دسترس بودن و انعطاف پذیری شدید نیاز دارد، زیرا خدمات مبتنی بر الگوی ژئود می توانند از دست دادن چندین منطقه خدماتی به طور همزمان جان سالم به در ببرند.  

این الگو ممکن است مناسب نباشد  
  
* معماری هایی که دارای محدودیت هایی هستند به طوری که همه ژئودها نمی توانند برای ذخیره سازی داده ها برابر باشند. برای مثال، ممکن است الزامات اقامت داده وجود داشته باشد، برنامه‌ای که نیاز به حفظ حالت موقت برای یک جلسه خاص دارد، یا وزن سنگین درخواست‌ها برای یک منطقه واحد. در این مورد، استفاده از مهرهای استقرار را در ترکیب با یک هواپیمای مسیریابی جهانی در نظر بگیرید که از محل قرارگیری داده های کاربر آگاه است، مانند مؤلفه مسیریابی ترافیک که در الگوی مهرهای استقرار توضیح داده شده است.  
* موقعیت هایی که نیازی به توزیع جغرافیایی نیست. در عوض، مناطق در دسترس و مناطق جفت شده را برای خوشه بندی در نظر بگیرید.  
* موقعیت هایی که یک پلت فرم قدیمی نیاز به مقاوم سازی دارد. این الگو فقط برای توسعه ابری کار می کند و به روز رسانی آن دشوار است.  
* معماری‌ها و الزامات ساده، که در آن افزونگی جغرافیایی و توزیع جغرافیایی مورد نیاز یا سودمند نیست.
## Examples

* مورد Windows Active Directory یک نوع اولیه از این الگو را پیاده سازی می کند. تکرار چند اولیه به این معنی است که همه به‌روزرسانی‌ها و درخواست‌ها در تئوری می‌توانند از تمام گره‌های قابل سرویس‌دهی ارائه شوند، اما نقش‌های Flexible Single Master Operation (FSMO) به این معنی است که همه ژئودها برابر نیستند.  
* شتاب دهنده الگوی geode در GitHub این الگوی طراحی را در عمل به نمایش می گذارد و برای کمک به توسعه دهندگان طراحی شده است که آن را با APIهای دنیای واقعی پیاده سازی کنند.  
* یک برنامه نمونه QnA در GitHub این الگوی طراحی را در عمل به نمایش می گذارد.  
 * مورد Geode Cache بر روی SAP OData API: نمونه OData API Geode مجموعه ای که توسط Azure Cosmos DB به عنوان یک کش داده با سرعت جهانی برای برنامه های SAP Retail پشتیبانی می شود.