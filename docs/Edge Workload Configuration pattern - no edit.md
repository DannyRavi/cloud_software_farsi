
تنوع زیاد سیستم ها و دستگاه ها در طبقه مغازه می تواند پیکربندی حجم کار را به یک مشکل دشوار تبدیل کند. این مقاله روش هایی برای حل آن ارائه می دهد.

## Context and problem

شرکت های تولیدی، به عنوان بخشی از سفر تحول دیجیتال خود، به طور فزاینده ای بر ساخت راه حل های نرم افزاری تمرکز می کنند که می توانند به عنوان قابلیت های مشترک مورد استفاده مجدد قرار گیرند. با توجه به انواع دستگاه ها و سیستم ها در طبقه فروشگاه، بارهای کاری ماژولار برای پشتیبانی از پروتکل ها، درایورها و فرمت های مختلف داده پیکربندی شده اند. گاهی اوقات حتی چندین نمونه از یک حجم کاری با پیکربندی های مختلف در یک مکان لبه اجرا می شوند. برای برخی از بارهای کاری، پیکربندی ها بیش از یک بار در روز به روز می شوند. بنابراین، مدیریت پیکربندی به طور فزاینده‌ای برای مقیاس‌بندی راه‌حل‌های خارج از لبه اهمیت دارد.

## Solution

چند ویژگی مشترک مدیریت پیکربندی برای بارهای کاری لبه وجود دارد:

* چندین نقطه پیکربندی وجود دارد که می‌توان آنها را در لایه‌های مجزا دسته‌بندی کرد، مانند منبع نرم‌افزار، خط لوله CI/CD، مستأجر ابر و مکان لبه:
![[Pasted image 20231205104835.png]]

* لایه های مختلف می تواند توسط افراد مختلف به روز شود.  
* مهم نیست که چگونه پیکربندی ها به روز می شوند، باید به دقت ردیابی و ممیزی شوند.  
* برای تداوم کسب و کار، لازم است که تنظیمات را بتوان به صورت آفلاین در لبه دسترسی داشت.  
* همچنین لازم است که یک نمای کلی از تنظیمات موجود در فضای ابری وجود داشته باشد.

## Issues and considerations

هنگام تصمیم گیری در مورد نحوه اجرای این الگوی ، نکات زیر را در نظر بگیرید:  
  
* اجازه ویرایش ها در صورت اتصال لبه به ابر ، پیچیدگی مدیریت پیکربندی را به میزان قابل توجهی افزایش می دهد. تکرار تغییرات در ابر امکان پذیر است ، اما چالش هایی با:  
* احراز هویت کاربر ، زیرا به یک سرویس ابری مانند Microsoft Entra ID متکی است.  
* حل و فصل درگیری پس از اتصال مجدد ، اگر بارهای کاری تنظیمات غیر منتظره ای را که نیاز به مداخله دستی دارند دریافت می کنند.  
* اگر توپولوژی مطابق با الزامات ISA-95 باشد ، محیط لبه می تواند محدودیت های مرتبط با شبکه داشته باشد. شما می توانید با انتخاب فناوری ای که اتصال به لایه ها را ارائه می دهد ، مانند سلسله مراتب دستگاه در Azure IoT Edge ، بر چنین محدودیت هایی غلبه کنید.  
* اگر پیکربندی زمان اجرا از نسخه های نرم افزاری جدا شود ، باید تغییرات پیکربندی به طور جداگانه انجام شود. برای ارائه تاریخچه و ویژگی های بازگشت ، باید تنظیمات گذشته را در یک داده در ابر ذخیره کنید.  
* یک خطای در یک پیکربندی ، مانند یک مؤلفه اتصال که به یک نقطه انتهایی وجود ندارد ، می تواند بار کار را بشکند. بنابراین ، درمان تغییرات پیکربندی مهم است زیرا شما با سایر حوادث چرخه عمر استقرار در راه حل مشاهده برخورد می کنید ، به طوری که داشبوردهای مشاهده می توانند به همبستگی خطاهای سیستم در تغییرات پیکربندی کمک کنند. برای اطلاعات بیشتر در مورد مشاهده ، به راهنمای نظارت بر ابر مراجعه کنید: مشاهده.  
* نقش هایی را که Datastores Cloud و Edge در تداوم تجارت بازی می کنند ، درک کنید. اگر Datastore Cloud منبع واحد حقیقت باشد ، باید بار کار Edge با استفاده از فرآیندهای خودکار بتواند حالت های مورد نظر را بازیابی کند.  
* برای انعطاف پذیری ، Datastore Edge باید به عنوان حافظه پنهان آفلاین عمل کند. این امر به ملاحظات تأخیر می رسد.

## When to use this pattern

از این الگو زمانی استفاده کنید که:  
  
* نیاز به پیکربندی بارهای کاری خارج از چرخه انتشار نرم افزار وجود دارد.  
* افراد مختلف باید بتوانند پیکربندی ها را بخوانند و به روز کنند.  
* حتی اگر هیچ اتصالی به فضای ابری وجود نداشته باشد، تنظیمات باید در دسترس باشند.  

نمونه بار کاری:  
  
* راه‌حل‌هایی که برای دریافت داده‌ها به دارایی‌های موجود در فروشگاه متصل می‌شوند - برای مثال OPC Publisher - و فرمان و کنترل  
* بارهای کاری یادگیری ماشین برای نگهداری پیش بینی شده  
* بارهای کاری یادگیری ماشینی که در زمان واقعی کیفیت را در خط تولید بررسی می کنند
## Examples

راه حل برای پیکربندی بارهای کاری لبه در طول زمان اجرا می تواند بر اساس یک کنترل کننده پیکربندی خارجی یا یک ارائه دهنده پیکربندی داخلی باشد.

### External configuration controller variation


![[Pasted image 20231205105157.png]]

این تغییر دارای یک کنترلر پیکربندی است که خارج از حجم کار است. نقش مؤلفه کنترلر پیکربندی ابری این است که ویرایش ها را از انبار داده ابری به حجم کاری از طریق کنترلر پیکربندی لبه فشار دهد. لبه همچنین حاوی یک ذخیره‌سازی اطلاعات است تا سیستم حتی در صورت قطع ارتباط با ابر کار کند.  
  
با IoT Edge، کنترل‌کننده پیکربندی لبه را می‌توان به‌عنوان یک ماژول پیاده‌سازی کرد، و تنظیمات را می‌توان با ماژول‌های دوقلو اعمال کرد. ماژول دوقلو دارای محدودیت اندازه است. اگر پیکربندی از حد مجاز فراتر رفت، راه حل را می توان با Azure Blob Storage یا با تقسیم بارهای بزرگتر از طریق روش های مستقیم گسترش داد.  
  
برای مثال سرتاسری از تغییرات کنترل‌کننده پیکربندی خارجی، خط لوله سیگنال کارخانه متصل را ببینید.  
  
مزایای این تنوع عبارتند از:

* خود حجم کار نباید از سیستم پیکربندی آگاه باشد. اگر کد منبع حجم کار قابل ویرایش نباشد - برای مثال، هنگام استفاده از یک ماژول از Azure IoT Edge Marketplace، این قابلیت الزامی است.  
* این امکان وجود دارد که پیکربندی چندین بار کاری را همزمان با هماهنگ کردن تغییرات از طریق کنترلر پیکربندی ابری تغییر دهید.  
* اعتبار سنجی اضافی را می توان به عنوان بخشی از خط لوله فشار اجرا کرد - به عنوان مثال، برای تأیید وجود نقاط انتهایی در لبه قبل از فشار دادن پیکربندی به حجم کاری.

### Internal configuration provider variation

![[Pasted image 20231205105249.png]]

در تنوع ارائه‌دهنده پیکربندی داخلی، حجم کار پیکربندی‌ها را از یک ارائه‌دهنده پیکربندی می‌کشد. برای مثال پیاده سازی، به پیاده سازی یک ارائه دهنده پیکربندی سفارشی در دات نت مراجعه کنید. این مثال از سی شارپ استفاده می کند، اما می توان از زبان های دیگر استفاده کرد.  
  
در این تغییر، بارهای کاری دارای شناسه های منحصر به فرد هستند به طوری که کد منبع یکسانی که در محیط های مختلف اجرا می شود، می تواند پیکربندی های متفاوتی داشته باشد. یکی از راه های ساخت یک شناسه، الحاق رابطه سلسله مراتبی حجم کار به یک گروه سطح بالا مانند مستاجر است. برای IoT Edge، می‌تواند ترکیبی از گروه منبع Azure، نام مرکز اینترنت اشیا، نام دستگاه IoT Edge و شناسه ماژول باشد. این مقادیر با هم یک شناسه منحصر به فرد را تشکیل می دهند که به عنوان یک کلید در انباره های داده کار می کند.  
  
اگرچه نسخه ماژول را می‌توان به شناسه منحصربه‌فرد اضافه کرد، این یک نیاز رایج برای تداوم پیکربندی‌ها در به‌روزرسانی‌های نرم‌افزار است. اگر نسخه بخشی از شناسه است، نسخه قدیمی پیکربندی باید با یک پیاده سازی اضافی به جلو منتقل شود.  
  
مزایای این تنوع عبارتند از:

* به غیر از ذخیره‌گاه‌های داده، راه‌حل به اجزای سازنده نیاز ندارد و پیچیدگی را کاهش می‌دهد.  
* منطق مهاجرت از نسخه‌های قدیمی ناسازگار را می‌توان در اجرای حجم کاری انجام داد.

### Solutions based on IoT Edge

![[Pasted image 20231205105353.png]]

مؤلفه ابری پیاده‌سازی مرجع IoT Edge شامل یک هاب اینترنت اشیا است که به عنوان کنترل‌کننده پیکربندی ابر عمل می‌کند. عملکرد دوقلو ماژول IoT Hub Azure تغییرات پیکربندی و اطلاعات مربوط به پیکربندی اعمال شده در حال حاضر را با استفاده از ویژگی‌های مورد نظر و گزارش شده ماژول منتشر می‌کند. سرویس مدیریت پیکربندی به عنوان منبع پیکربندی ها عمل می کند. همچنین می‌تواند یک رابط کاربری برای مدیریت پیکربندی‌ها، یک سیستم ساخت و سایر ابزارهایی باشد که برای نگارش پیکربندی‌های حجم کاری استفاده می‌شوند.  
  
یک پایگاه داده Azure Cosmos DB تمام تنظیمات را ذخیره می کند. این می تواند با چندین هاب اینترنت اشیا تعامل داشته باشد و تاریخچه پیکربندی را ارائه دهد.  
  
پس از اینکه یک دستگاه لبه از طریق ویژگی های گزارش شده نشان داد که یک پیکربندی اعمال شده است، سرویس وضعیت پیکربندی رویداد را در نمونه پایگاه داده یادداشت می کند.  
  
هنگامی که یک پیکربندی جدید در سرویس مدیریت پیکربندی ایجاد می‌شود، در Azure Cosmos DB ذخیره می‌شود و ویژگی‌های مورد نظر ماژول لبه در هاب IoT که دستگاه در آن قرار دارد تغییر می‌کند. سپس پیکربندی توسط IoT Hub به دستگاه لبه منتقل می شود. انتظار می رود که ماژول لبه پیکربندی را اعمال کند و از طریق ماژول وضعیت پیکربندی را گزارش دهد. سپس سرویس وضعیت پیکربندی به رویدادهای تغییر دوگانه گوش می دهد و با تشخیص اینکه یک ماژول تغییر وضعیت پیکربندی را گزارش می دهد، تغییر مربوطه را در پایگاه داده Azure Cosmos DB ثبت می کند.  
  
جزء لبه می تواند از کنترلر پیکربندی خارجی یا ارائه دهنده پیکربندی داخلی استفاده کند. در هر دو پیاده‌سازی، پیکربندی یا در ویژگی‌های دلخواه دوگانه ماژول منتقل می‌شود، یا در صورت نیاز به انتقال پیکربندی‌های بزرگ، ویژگی‌های مورد نظر دوگانه ماژول حاوی URL به Azure Blob Storage یا به سرویس دیگری است که می‌تواند برای بازیابی پیکربندی استفاده شود. . سپس ماژول در ویژگی‌های گزارش شده دوقلو ماژول سیگنال می‌دهد که آیا پیکربندی جدید با موفقیت اعمال شده است و چه پیکربندی در حال حاضر اعمال می‌شود.

## Contributors

این مقاله توسط مایکروسافت نگهداری می شود. در اصل توسط مشارکت کنندگان زیر نوشته شده است.  
  
نویسنده اصلی:

- [Heather Camm](https://www.linkedin.com/in/heather-camm-2367ba15/) | Senior Program Manager

_To see non-public LinkedIn profiles, sign in to LinkedIn._